#!/bin/bash
set -e

source $(dirname $0)/version

cd $(dirname $0)/..

CHART=${CHART:-rancher-project-monitoring}
VERSION=${CHART_VERSION:-$(find ./charts/${CHART} -maxdepth 1 -mindepth 1 -type d | tr - \~ | sort -rV | tr \~ - | head -n1 | cut -d'/' -f4)}

helm package charts/${CHART}/${VERSION} --destination bin/${CHART}
base64 -i bin/${CHART}/${CHART}-${VERSION}.tgz > bin/${CHART}/${CHART}.tgz.base64
rm bin/${CHART}/${CHART}-${VERSION}.tgz

echo "Completed ${CHART} (${VERSION}) build process."